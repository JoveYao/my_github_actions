name: ðŸ“¦ Download Grafana Plugins

on:
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  download:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ› ï¸ Checkout code
        uses: actions/checkout@v4

      - name: ðŸŒ Download Grafana Plugins
        run: |
          mkdir -p plugins
          echo "Downloading grafana-lokiexplore-app v1.0.34..."
          wget -O plugins/grafana-lokiexplore-app.zip https://storage.googleapis.com/grafana-plugins-catalog/grafana-lokiexplore-app/release/1.0.34/grafana-lokiexplore-app-1.0.34.zip

          echo "Downloading grafana-exploretraces-app v1.3.0..."
          wget -O plugins/grafana-exploretraces-app.zip https://storage.googleapis.com/grafana-plugins-catalog/grafana-exploretraces-app/release/1.3.0/grafana-exploretraces-app-1.3.0.zip

          echo "Downloading grafana-metricsdrilldown-app v1.0.29..."
          wget -O plugins/grafana-metricsdrilldown-app.zip https://storage.googleapis.com/grafana-plugins-catalog/grafana-metricsdrilldown-app/release/1.0.29/grafana-metricsdrilldown-app-1.0.29.zip

      - name: ðŸ—ƒï¸ Unzip and verify
        run: |
          cd plugins
          unzip -q grafana-lokiexplore-app.zip -d lokiexplore
          unzip -q grafana-exploretraces-app.zip -d exploretraces
          unzip -q grafana-metricsdrilldown-app.zip -d metricsdrilldown
          echo "Plugin directories:"
          ls -la

      - name: ðŸ“¦ Create final archive
        run: |
          zip -r grafana-plugins-offline.zip plugins/

      - name: ðŸš€ Upload to Release
        uses: softprops/action-gh-release@v2
        with:
          files: grafana-plugins-offline.zip
          tag_name: v1.0.34-1.3.0-1.0.29
          name: Grafana Plugins Bundle (Loki + Traces + Metrics Drilldown)
          body: |
            Contains:
            - grafana-lokiexplore-app v1.0.34
            - grafana-exploretraces-app v1.3.0
            - grafana-metricsdrilldown-app v1.0.29
            
            Compatible with Grafana >=12.0
